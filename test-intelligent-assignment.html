<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½éšæœºåˆ†é…ç®—æ³•æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 5px;
            margin: 10px 0;
        }
        .cell {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 12px;
            text-align: center;
            min-height: 60px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .punishment-cell {
            background: #ffe6e6;
            border-color: #ff9999;
        }
        .other-cell {
            background: #f0f0f0;
            border-color: #ccc;
        }
        .position-number {
            font-weight: bold;
            color: #666;
            margin-bottom: 2px;
        }
        .combination-info {
            font-size: 10px;
            line-height: 1.2;
        }
        .tool { color: #d63384; font-weight: bold; }
        .bodypart { color: #0d6efd; }
        .position { color: #198754; }
        .strikes { color: #fd7e14; font-weight: bold; }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            background: #e7f3ff;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 15px;
        }
        .stat-box {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            border-left: 4px solid #007bff;
        }
        .stat-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .diversity-score {
            font-size: 24px;
            font-weight: bold;
            color: #28a745;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ æ™ºèƒ½éšæœºåˆ†é…ç®—æ³•æµ‹è¯•</h1>
        <p>æµ‹è¯•æ–°çš„æ™ºèƒ½éšæœºåˆ†é…ç®—æ³•ï¼šåœ¨è¿ç»­6ä¸ªæ ¼å­èŒƒå›´å†…å¢åŠ æƒ©ç½šç»„åˆå¤šæ ·æ€§</p>

        <div class="test-section">
            <div class="test-title">æµ‹è¯•1ï¼šæ™ºèƒ½åˆ†é… vs ä¼ ç»Ÿå¾ªç¯åˆ†é…å¯¹æ¯”</div>
            <button onclick="testIntelligentAssignment()">ç”Ÿæˆæ™ºèƒ½åˆ†é…</button>
            <button onclick="testTraditionalAssignment()">ç”Ÿæˆä¼ ç»Ÿåˆ†é…</button>
            <button onclick="compareAssignments()">å¯¹æ¯”åˆ†æ</button>
            <div id="assignment-result" class="result" style="display:none;"></div>
        </div>

        <div class="test-section">
            <div class="test-title">æµ‹è¯•2ï¼šè¿ç»­6æ ¼å¤šæ ·æ€§åˆ†æ</div>
            <button onclick="analyzeDiversity()">åˆ†æå¤šæ ·æ€§</button>
            <div id="diversity-result" class="result" style="display:none;"></div>
        </div>

        <div class="test-section">
            <div class="test-title">æµ‹è¯•3ï¼šå¤šæ¬¡ç”Ÿæˆç¨³å®šæ€§æµ‹è¯•</div>
            <button onclick="testStability()">ç¨³å®šæ€§æµ‹è¯•ï¼ˆ10æ¬¡ï¼‰</button>
            <div id="stability-result" class="result" style="display:none;"></div>
        </div>
    </div>

    <script type="module">
        // æ¨¡æ‹Ÿé…ç½®
        const mockConfig = {
            tools: [
                { id: 'hand', name: 'æ‰‹æŒ', intensity: 2, ratio: 30 },
                { id: 'ruler', name: 'å°ºå­', intensity: 4, ratio: 25 },
                { id: 'paddle', name: 'æ‹å­', intensity: 3, ratio: 20 },
                { id: 'belt', name: 'çš®å¸¦', intensity: 5, ratio: 15 },
                { id: 'cane', name: 'è—¤æ¡', intensity: 6, ratio: 10 }
            ],
            bodyParts: [
                { id: 'butt', name: 'å±è‚¡', sensitivity: 5, ratio: 40 },
                { id: 'palm', name: 'æ‰‹å¿ƒ', sensitivity: 3, ratio: 25 },
                { id: 'thigh', name: 'å¤§è…¿', sensitivity: 4, ratio: 20 },
                { id: 'back', name: 'åèƒŒ', sensitivity: 6, ratio: 15 }
            ],
            positions: [
                { id: 'standing', name: 'ç«™ç«‹', ratio: 30 },
                { id: 'bending', name: 'å¼¯è…°', ratio: 25 },
                { id: 'kneeling', name: 'è·ªè¶´', ratio: 20 },
                { id: 'lying', name: 'è¶´ç€', ratio: 25 }
            ],
            minStrikes: 10,
            maxStrikes: 30,
            step: 5
        };

        // ç”Ÿæˆç»„åˆå®šä¹‰
        function generateCombinations(count = 8) {
            const combinations = [];
            const tools = mockConfig.tools.filter(t => t.ratio > 0);
            const bodyParts = mockConfig.bodyParts.filter(b => b.ratio > 0);
            const positions = mockConfig.positions.filter(p => p.ratio > 0);
            
            for (let i = 0; i < count; i++) {
                const tool = tools[i % tools.length];
                const bodyPart = bodyParts[Math.floor(i / tools.length) % bodyParts.length];
                const position = positions[Math.floor(i / (tools.length * bodyParts.length)) % positions.length];
                
                combinations.push({
                    tool,
                    bodyPart,
                    position,
                    description: `ç”¨${tool.name}æ‰“${bodyPart.name}ï¼Œå§¿åŠ¿ï¼š${position.name}`
                });
            }
            
            return combinations;
        }

        // æ¨¡æ‹Ÿæ£‹ç›˜ï¼ˆ40æ ¼ï¼Œ28ä¸ªæƒ©ç½šæ ¼å­ï¼‰
        function createMockBoard() {
            const board = [];
            const punishmentPositions = [];
            
            // ç”Ÿæˆæƒ©ç½šæ ¼å­ä½ç½®ï¼ˆæ’é™¤èµ·ç‚¹1å’Œç»ˆç‚¹40ï¼‰
            for (let i = 2; i <= 39; i++) {
                if (punishmentPositions.length < 28) {
                    punishmentPositions.push(i);
                }
            }
            
            // éšæœºæ‰“ä¹±ä½ç½®
            for (let i = punishmentPositions.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [punishmentPositions[i], punishmentPositions[j]] = [punishmentPositions[j], punishmentPositions[i]];
            }
            
            // åˆ›å»ºæ£‹ç›˜
            for (let i = 1; i <= 40; i++) {
                if (i === 1 || i === 40) {
                    board.push({ position: i, type: 'bonus' });
                } else if (punishmentPositions.includes(i)) {
                    board.push({ position: i, type: 'punishment' });
                } else {
                    board.push({ position: i, type: 'other' });
                }
            }
            
            return board;
        }

        // ä¼ ç»Ÿå¾ªç¯åˆ†é…
        function traditionalAssignment(board, combinations) {
            const punishmentCells = board.filter(cell => cell.type === 'punishment');
            const result = [];
            
            punishmentCells.forEach((cell, index) => {
                const combinationIndex = index % combinations.length;
                const combination = combinations[combinationIndex];
                const strikes = Math.floor(Math.random() * 4 + 2) * 5; // 10-25
                
                result.push({
                    position: cell.position,
                    combination,
                    strikes,
                    description: `${combination.description}${strikes}ä¸‹`
                });
            });
            
            return result.sort((a, b) => a.position - b.position);
        }

        // æ™ºèƒ½åˆ†é…ï¼ˆç®€åŒ–ç‰ˆæœ¬ï¼‰
        function intelligentAssignment(board, combinations) {
            const punishmentCells = board.filter(cell => cell.type === 'punishment');
            const sortedCells = punishmentCells.sort((a, b) => a.position - b.position);
            const result = [];
            
            for (const cell of sortedCells) {
                const windowCombinations = getWindowCombinations(result, cell.position, 6);
                const bestCombination = selectOptimalCombination(combinations, windowCombinations);
                const strikes = Math.floor(Math.random() * 4 + 2) * 5; // 10-25
                
                const assignment = {
                    position: cell.position,
                    combination: bestCombination,
                    strikes,
                    description: `${bestCombination.description}${strikes}ä¸‹`
                };
                
                result.push(assignment);
            }
            
            return result.sort((a, b) => a.position - b.position);
        }

        // è·å–çª—å£å†…çš„ç»„åˆ
        function getWindowCombinations(assignments, currentPosition, windowSize = 6) {
            const halfWindow = Math.floor(windowSize / 2);
            return assignments.filter(assignment => {
                const distance = Math.abs(assignment.position - currentPosition);
                return distance <= halfWindow && assignment.position !== currentPosition;
            }).map(assignment => assignment.combination);
        }

        // è®¡ç®—å¤šæ ·æ€§è¯„åˆ†
        function calculateDiversityScore(candidate, windowCombinations) {
            if (windowCombinations.length === 0) return 100;
            
            let score = 100;
            const toolRepeats = windowCombinations.filter(combo => combo.tool.id === candidate.tool.id).length;
            const bodyPartRepeats = windowCombinations.filter(combo => combo.bodyPart.id === candidate.bodyPart.id).length;
            const positionRepeats = windowCombinations.filter(combo => combo.position.id === candidate.position.id).length;
            
            score -= toolRepeats * 30;
            score -= bodyPartRepeats * 20;
            score -= positionRepeats * 10;
            
            return Math.max(0, score);
        }

        // é€‰æ‹©æœ€ä¼˜ç»„åˆ
        function selectOptimalCombination(availableCombinations, windowCombinations) {
            if (availableCombinations.length === 1) return availableCombinations[0];
            
            const scoredCombinations = availableCombinations.map(combo => ({
                combination: combo,
                score: calculateDiversityScore(combo, windowCombinations)
            }));
            
            const maxScore = Math.max(...scoredCombinations.map(item => item.score));
            const topCombinations = scoredCombinations.filter(item => item.score === maxScore);
            
            const randomIndex = Math.floor(Math.random() * topCombinations.length);
            return topCombinations[randomIndex].combination;
        }

        // æµ‹è¯•å‡½æ•°å°†åœ¨ä¸‹ä¸€éƒ¨åˆ†æ·»åŠ ...
        let currentBoard = null;
        let currentCombinations = null;
        let intelligentResult = null;
        let traditionalResult = null;

        // å…¨å±€å‡½æ•°å£°æ˜
        window.testIntelligentAssignment = function() {
            alert('æ™ºèƒ½åˆ†é…æµ‹è¯•åŠŸèƒ½æ­£åœ¨åŠ è½½...');
        };
        
        window.testTraditionalAssignment = function() {
            alert('ä¼ ç»Ÿåˆ†é…æµ‹è¯•åŠŸèƒ½æ­£åœ¨åŠ è½½...');
        };
        
        window.compareAssignments = function() {
            alert('å¯¹æ¯”åˆ†æåŠŸèƒ½æ­£åœ¨åŠ è½½...');
        };
        
        window.analyzeDiversity = function() {
            alert('å¤šæ ·æ€§åˆ†æåŠŸèƒ½æ­£åœ¨åŠ è½½...');
        };
        
        window.testStability = function() {
            alert('ç¨³å®šæ€§æµ‹è¯•åŠŸèƒ½æ­£åœ¨åŠ è½½...');
        };
    </script>
</body>
</html>
