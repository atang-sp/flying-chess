<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é£è¡Œæ£‹é…ç½®å¯¼å‡ºåŠŸèƒ½æµ‹è¯•</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .test-section {
            margin-bottom: 40px;
            padding: 30px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            background: #f9fafb;
        }

        .test-section h2 {
            color: #1f2937;
            margin-bottom: 20px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .export-demo {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .config-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .option-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            transition: all 0.2s;
            cursor: pointer;
        }

        .option-card:hover {
            border-color: #3b82f6;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
        }

        .option-card.selected {
            border-color: #3b82f6;
            background: #eff6ff;
        }

        .option-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 10px;
        }

        .option-checkbox {
            width: 20px;
            height: 20px;
            accent-color: #3b82f6;
        }

        .option-icon {
            font-size: 1.5rem;
        }

        .option-title {
            font-weight: 600;
            color: #1f2937;
        }

        .option-desc {
            color: #6b7280;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .stats-panel {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1e40af;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #6b7280;
            margin-top: 5px;
        }

        .export-btn {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 15px 30px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            width: 100%;
            margin-top: 20px;
        }

        .export-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.3);
        }

        .export-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .result-panel {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            display: none;
        }

        .result-panel.show {
            display: block;
        }

        .result-panel.error {
            background: #fef2f2;
            border-color: #fecaca;
        }

        .json-preview {
            background: #1f2937;
            color: #f9fafb;
            border-radius: 8px;
            padding: 20px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            overflow-x: auto;
            margin-top: 15px;
            max-height: 400px;
            overflow-y: auto;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 12px;
            }
            
            .content {
                padding: 20px;
            }
            
            .config-options {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ² é£è¡Œæ£‹é…ç½®å¯¼å‡ºæµ‹è¯•</h1>
            <p>æµ‹è¯•é…ç½®å¯¼å‡ºåŠŸèƒ½çš„å®Œæ•´æµç¨‹</p>
        </div>

        <div class="content">
            <div class="test-section">
                <h2>ğŸ“¤ é…ç½®å¯¼å‡ºæ¼”ç¤º</h2>
                <div class="export-demo">
                    <p style="margin-bottom: 20px; color: #6b7280;">é€‰æ‹©è¦å¯¼å‡ºçš„é…ç½®é¡¹ï¼Œç„¶åç‚¹å‡»å¯¼å‡ºæŒ‰é’®æµ‹è¯•åŠŸèƒ½ï¼š</p>
                    
                    <div class="config-options">
                        <div class="option-card" onclick="toggleOption('playerSettings')">
                            <div class="option-header">
                                <input type="checkbox" class="option-checkbox" id="playerSettings" checked>
                                <span class="option-icon">ğŸ‘¥</span>
                                <span class="option-title">ç©å®¶è®¾ç½®</span>
                            </div>
                            <div class="option-desc">ç©å®¶æ•°é‡å’Œå§“åé…ç½®</div>
                        </div>

                        <div class="option-card" onclick="toggleOption('punishmentConfig')">
                            <div class="option-header">
                                <input type="checkbox" class="option-checkbox" id="punishmentConfig" checked>
                                <span class="option-icon">âš™ï¸</span>
                                <span class="option-title">æƒ©ç½šè®¾ç½®</span>
                            </div>
                            <div class="option-desc">å·¥å…·ã€éƒ¨ä½ã€å§¿åŠ¿ç­‰é…ç½®</div>
                        </div>

                        <div class="option-card" onclick="toggleOption('boardConfig')">
                            <div class="option-header">
                                <input type="checkbox" class="option-checkbox" id="boardConfig" checked>
                                <span class="option-icon">ğŸ¯</span>
                                <span class="option-title">æ£‹ç›˜è®¾ç½®</span>
                            </div>
                            <div class="option-desc">å„ç§æ ¼å­æ•°é‡é…ç½®</div>
                        </div>

                        <div class="option-card" onclick="toggleOption('trapConfig')">
                            <div class="option-header">
                                <input type="checkbox" class="option-checkbox" id="trapConfig" checked>
                                <span class="option-icon">ğŸ”§</span>
                                <span class="option-title">æœºå…³è®¾ç½®</span>
                            </div>
                            <div class="option-desc">æœºå…³æ ¼å­é…ç½®</div>
                        </div>

                        <div class="option-card" onclick="toggleOption('boardContent')">
                            <div class="option-header">
                                <input type="checkbox" class="option-checkbox" id="boardContent">
                                <span class="option-icon">ğŸ²</span>
                                <span class="option-title">æ£‹ç›˜å¸ƒå±€</span>
                            </div>
                            <div class="option-desc">å®Œæ•´æ£‹ç›˜å¸ƒå±€ï¼ˆå«éšæœºç§å­ï¼‰</div>
                        </div>
                    </div>

                    <div class="stats-panel">
                        <h3 style="margin-bottom: 15px; color: #1e40af;">ğŸ“Š å¯¼å‡ºç»Ÿè®¡</h3>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-value" id="itemCount">4</div>
                                <div class="stat-label">é…ç½®é¡¹æ•°é‡</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="fileSize">2.1 KB</div>
                                <div class="stat-label">é¢„ä¼°æ–‡ä»¶å¤§å°</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="qrSize">2.7 KB</div>
                                <div class="stat-label">äºŒç»´ç å¤§å°</div>
                            </div>
                        </div>
                    </div>

                    <button class="export-btn" onclick="performExport()">
                        ğŸ“¤ å¯¼å‡º JSON æ–‡ä»¶
                    </button>

                    <div class="result-panel" id="resultPanel">
                        <h4 style="margin-bottom: 10px;">âœ… å¯¼å‡ºæˆåŠŸï¼</h4>
                        <p id="resultMessage">é…ç½®æ–‡ä»¶å·²ç”Ÿæˆå¹¶ä¸‹è½½</p>
                        <div class="action-buttons">
                            <button class="btn btn-secondary" onclick="showJsonPreview()">ğŸ‘ï¸ é¢„è§ˆ JSON</button>
                            <button class="btn btn-success" onclick="downloadAgain()">ğŸ’¾ é‡æ–°ä¸‹è½½</button>
                        </div>
                        <div class="json-preview" id="jsonPreview" style="display: none;"></div>
                    </div>
                </div>
            </div>

            <div class="test-section">
                <h2>ğŸ§ª åŠŸèƒ½æµ‹è¯•æŒ‡å—</h2>
                <ol style="line-height: 1.8; color: #374151;">
                    <li><strong>é€‰æ‹©é…ç½®é¡¹ï¼š</strong>ç‚¹å‡»ä¸Šæ–¹çš„é…ç½®å¡ç‰‡æ¥é€‰æ‹©/å–æ¶ˆé€‰æ‹©è¦å¯¼å‡ºçš„å†…å®¹</li>
                    <li><strong>æŸ¥çœ‹ç»Ÿè®¡ï¼š</strong>è§‚å¯Ÿç»Ÿè®¡é¢æ¿ä¸­çš„æ•°æ®å˜åŒ–</li>
                    <li><strong>æ‰§è¡Œå¯¼å‡ºï¼š</strong>ç‚¹å‡»"å¯¼å‡º JSON æ–‡ä»¶"æŒ‰é’®</li>
                    <li><strong>éªŒè¯ç»“æœï¼š</strong>æ£€æŸ¥ä¸‹è½½çš„æ–‡ä»¶å†…å®¹æ˜¯å¦æ­£ç¡®</li>
                    <li><strong>é¢„è§ˆåŠŸèƒ½ï¼š</strong>ä½¿ç”¨"é¢„è§ˆ JSON"æŸ¥çœ‹å¯¼å‡ºæ•°æ®ç»“æ„</li>
                </ol>
            </div>

            <div class="test-section">
                <h2>ğŸ“‹ æµ‹è¯•æ£€æŸ¥æ¸…å•</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px;">
                    <label style="display: flex; align-items: center; gap: 10px; padding: 10px; background: white; border-radius: 6px;">
                        <input type="checkbox" style="width: 18px; height: 18px;">
                        <span>é…ç½®é¡¹é€‰æ‹©åŠŸèƒ½æ­£å¸¸</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px; padding: 10px; background: white; border-radius: 6px;">
                        <input type="checkbox" style="width: 18px; height: 18px;">
                        <span>ç»Ÿè®¡ä¿¡æ¯å®æ—¶æ›´æ–°</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px; padding: 10px; background: white; border-radius: 6px;">
                        <input type="checkbox" style="width: 18px; height: 18px;">
                        <span>æ–‡ä»¶ä¸‹è½½åŠŸèƒ½æ­£å¸¸</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px; padding: 10px; background: white; border-radius: 6px;">
                        <input type="checkbox" style="width: 18px; height: 18px;">
                        <span>JSONæ ¼å¼æ­£ç¡®</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px; padding: 10px; background: white; border-radius: 6px;">
                        <input type="checkbox" style="width: 18px; height: 18px;">
                        <span>æ–‡ä»¶ååŒ…å«æ—¶é—´æˆ³</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px; padding: 10px; background: white; border-radius: 6px;">
                        <input type="checkbox" style="width: 18px; height: 18px;">
                        <span>æ•°æ®å†…å®¹å®Œæ•´</span>
                    </label>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿé…ç½®æ•°æ®
        const mockData = {
            playerSettings: {
                playerCount: 2,
                playerNames: ["ç©å®¶1", "ç©å®¶2"]
            },
            punishmentConfig: {
                tools: [
                    { id: 'hand', name: 'æ‰‹æŒ', intensity: 2, ratio: 30 },
                    { id: 'ruler', name: 'å°ºå­', intensity: 3, ratio: 25 },
                    { id: 'cane', name: 'è—¤æ¡', intensity: 4, ratio: 20 }
                ],
                bodyParts: [
                    { id: 'butt', name: 'å±è‚¡', sensitivity: 10, ratio: 80 },
                    { id: 'back', name: 'åèƒŒ', sensitivity: 7, ratio: 10 },
                    { id: 'thighs', name: 'å¤§è…¿', sensitivity: 5, ratio: 10 }
                ],
                positions: [
                    { id: 'standing', name: 'ç«™ç«‹', ratio: 25 },
                    { id: 'wall_lean', name: 'æ‰‹æ‰¶å¢™', ratio: 25 },
                    { id: 'table_lean', name: 'è¶´åœ¨æ¡Œå­ä¸Š', ratio: 25 },
                    { id: 'kneeling', name: 'è·ªè¶´', ratio: 25 }
                ],
                minStrikes: 10,
                maxStrikes: 30,
                step: 5,
                maxTakeoffFailures: 5
            },
            boardConfig: {
                punishmentCells: 28,
                bonusCells: 1,
                reverseCells: 2,
                restCells: 1,
                restartCells: 4,
                trapCells: 2,
                totalCells: 40
            },
            trapConfig: [
                {
                    id: 'trap_1',
                    name: 'æ™¾è‡€æœºå…³',
                    description: 'æ™¾è‡€5åˆ†é’Ÿ'
                },
                {
                    id: 'trap_2',
                    name: 'éšæœºæƒ©ç½šæœºå…³',
                    description: 'ç”±ä¸Šä¸€ä¸ªè¢«æƒ©ç½šçš„ç©å®¶ä½¿ç”¨ä»»æ„å·¥å…·æƒ©ç½šå±è‚¡'
                }
            ],
            boardContent: {
                seed: "abc123def456",
                board: Array.from({length: 40}, (_, i) => ({
                    id: i + 1,
                    type: i === 0 ? 'bonus' : (i % 5 === 0 ? 'special' : 'punishment'),
                    position: i + 1,
                    effect: {
                        type: i === 0 ? 'move' : 'punishment',
                        value: i === 0 ? 0 : 1,
                        description: i === 0 ? 'èµ·ç‚¹' : 'æƒ©ç½šæ ¼å­'
                    }
                })),
                generatedAt: Date.now()
            }
        };

        let currentExportData = null;

        // è·å–å½“å‰é€‰æ‹©çš„é€‰é¡¹
        function getSelectedOptions() {
            return {
                playerSettings: document.getElementById('playerSettings').checked,
                punishmentConfig: document.getElementById('punishmentConfig').checked,
                boardConfig: document.getElementById('boardConfig').checked,
                trapConfig: document.getElementById('trapConfig').checked,
                boardContent: document.getElementById('boardContent').checked
            };
        }

        // åˆ‡æ¢é€‰é¡¹
        function toggleOption(optionId) {
            const checkbox = document.getElementById(optionId);
            checkbox.checked = !checkbox.checked;
            updateOptionCard(optionId);
            updateStats();
        }

        // æ›´æ–°é€‰é¡¹å¡ç‰‡æ ·å¼
        function updateOptionCard(optionId) {
            const checkbox = document.getElementById(optionId);
            const card = checkbox.closest('.option-card');
            if (checkbox.checked) {
                card.classList.add('selected');
            } else {
                card.classList.remove('selected');
            }
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            const options = getSelectedOptions();
            const selectedCount = Object.values(options).filter(Boolean).length;
            
            // æ¨¡æ‹Ÿè®¡ç®—æ–‡ä»¶å¤§å°
            let estimatedSize = 500; // åŸºç¡€å¤§å°
            if (options.playerSettings) estimatedSize += 200;
            if (options.punishmentConfig) estimatedSize += 800;
            if (options.boardConfig) estimatedSize += 300;
            if (options.trapConfig) estimatedSize += 400;
            if (options.boardContent) estimatedSize += 2000;

            document.getElementById('itemCount').textContent = selectedCount;
            document.getElementById('fileSize').textContent = (estimatedSize / 1024).toFixed(1) + ' KB';
            document.getElementById('qrSize').textContent = (estimatedSize * 1.3 / 1024).toFixed(1) + ' KB';
        }

        // ç”Ÿæˆå¯¼å‡ºæ•°æ®
        function generateExportData(options) {
            const data = {
                version: "1.0.0",
                exportedAt: new Date().toISOString(),
                gameTitle: "é£è¡Œæ£‹é…ç½®",
                description: "æ¸¸æˆé…ç½®å¯¼å‡ºæ–‡ä»¶",
                data: {}
            };

            if (options.playerSettings) data.data.playerSettings = mockData.playerSettings;
            if (options.punishmentConfig) data.data.punishmentConfig = mockData.punishmentConfig;
            if (options.boardConfig) data.data.boardConfig = mockData.boardConfig;
            if (options.trapConfig) data.data.trapConfig = mockData.trapConfig;
            if (options.boardContent) data.data.boardContent = mockData.boardContent;

            return data;
        }

        // ç”Ÿæˆæ–‡ä»¶å
        function generateFilename(options) {
            const timestamp = new Date().toISOString().slice(0, 19).replace(/[:-]/g, '');
            const parts = [];
            
            if (options.playerSettings) parts.push('ç©å®¶');
            if (options.punishmentConfig) parts.push('æƒ©ç½š');
            if (options.boardConfig) parts.push('æ£‹ç›˜');
            if (options.trapConfig) parts.push('æœºå…³');
            if (options.boardContent) parts.push('å¸ƒå±€');
            
            const configType = parts.length > 0 ? parts.join('-') : 'é…ç½®';
            return `é£è¡Œæ£‹-${configType}-${timestamp}.json`;
        }

        // æ‰§è¡Œå¯¼å‡º
        function performExport() {
            const options = getSelectedOptions();
            const selectedCount = Object.values(options).filter(Boolean).length;
            
            if (selectedCount === 0) {
                alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªé…ç½®é¡¹ï¼');
                return;
            }

            try {
                const exportData = generateExportData(options);
                const filename = generateFilename(options);
                const jsonString = JSON.stringify(exportData, null, 2);
                
                // åˆ›å»ºä¸‹è½½
                const blob = new Blob([jsonString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);

                // ä¿å­˜å½“å‰å¯¼å‡ºæ•°æ®
                currentExportData = { data: exportData, filename };

                // æ˜¾ç¤ºæˆåŠŸç»“æœ
                showResult(true, `æ–‡ä»¶ "${filename}" å·²æˆåŠŸä¸‹è½½ï¼`);
                
            } catch (error) {
                showResult(false, `å¯¼å‡ºå¤±è´¥: ${error.message}`);
            }
        }

        // æ˜¾ç¤ºç»“æœ
        function showResult(success, message) {
            const panel = document.getElementById('resultPanel');
            const messageEl = document.getElementById('resultMessage');
            
            panel.className = 'result-panel show' + (success ? '' : ' error');
            messageEl.textContent = message;
            
            if (success) {
                panel.querySelector('h4').textContent = 'âœ… å¯¼å‡ºæˆåŠŸï¼';
            } else {
                panel.querySelector('h4').textContent = 'âŒ å¯¼å‡ºå¤±è´¥ï¼';
            }
        }

        // æ˜¾ç¤ºJSONé¢„è§ˆ
        function showJsonPreview() {
            if (!currentExportData) return;
            
            const preview = document.getElementById('jsonPreview');
            const jsonString = JSON.stringify(currentExportData.data, null, 2);
            preview.textContent = jsonString;
            preview.style.display = preview.style.display === 'none' ? 'block' : 'none';
        }

        // é‡æ–°ä¸‹è½½
        function downloadAgain() {
            if (!currentExportData) return;
            
            const jsonString = JSON.stringify(currentExportData.data, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = currentExportData.filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–é€‰é¡¹å¡ç‰‡æ ·å¼
            ['playerSettings', 'punishmentConfig', 'boardConfig', 'trapConfig'].forEach(updateOptionCard);
            updateStats();
        });
    </script>
</body>
</html>
