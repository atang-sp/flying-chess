# 飞行棋配置导出功能

## 功能概述

配置导出功能允许用户将游戏的各种配置保存为JSON文件，方便分享、备份和恢复游戏设置。

## 支持的配置类型

### 1. 玩家设置 (playerSettings)

- 玩家数量
- 玩家姓名列表

### 2. 惩罚设置 (punishmentConfig)

- 惩罚工具配置（名称、强度、比例）
- 身体部位配置（名称、敏感度、比例）
- 惩罚姿势配置（名称、比例）
- 惩罚次数范围（最小值、最大值、步长）
- 最大起飞失败次数

### 3. 棋盘设置 (boardConfig)

- 各种格子类型的数量配置
- 惩罚格子、奖励格子、后退格子等

### 4. 机关设置 (trapConfig)

- 机关格子的配置
- 机关名称和描述

### 5. 棋盘布局 (boardContent)

- 完整的棋盘布局数据
- 随机种子（用于重现相同的棋盘布局）
- 生成时间戳

## 文件结构

### 新增文件

1. **src/types/export.ts** - 导出功能的类型定义
2. **src/utils/export.ts** - 导出功能的核心逻辑
3. **src/components/ConfigExport.vue** - 导出界面组件

### 修改文件

1. **src/App.vue** - 集成导出功能到主应用
2. **src/utils/cache.ts** - 扩展缓存功能（如需要）

## 导出协议

### JSON格式

```json
{
  "version": "1.0.0",
  "exportedAt": "2025-07-20T10:30:00.000Z",
  "gameTitle": "飞行棋配置",
  "description": "游戏配置导出文件",
  "data": {
    "playerSettings": { ... },
    "punishmentConfig": { ... },
    "boardConfig": { ... },
    "trapConfig": { ... },
    "boardContent": { ... }
  }
}
```

### 字段说明

- `version`: 导出格式版本号
- `exportedAt`: 导出时间（ISO 8601格式）
- `gameTitle`: 配置文件标题
- `description`: 配置文件描述
- `data`: 实际的配置数据

## 核心功能

### 1. 选择性导出

用户可以选择需要导出的配置项，不必导出所有配置。

### 2. 文件名生成

自动生成包含时间戳和配置类型的文件名：

```
飞行棋-玩家-惩罚-棋盘-20250720T103000.json
```

### 3. 统计信息

实时显示：

- 导出配置项数量
- 文件大小
- 预估二维码大小

### 4. 数据验证

导出前验证数据完整性，确保配置的有效性。

## 使用方法

### 1. 打开导出界面

点击游戏左下角的"📤 导出"按钮

### 2. 选择配置项

勾选需要导出的配置类型：

- ✅ 玩家设置
- ✅ 惩罚设置
- ✅ 棋盘设置
- ✅ 机关设置
- ✅ 棋盘布局

### 3. 导出文件

点击"导出 JSON 文件"按钮，浏览器会自动下载配置文件。

## 技术实现

### 1. 数据收集

从LocalStorage和当前游戏状态收集配置数据：

```typescript
const data = collectExportData(options, currentBoard)
```

### 2. 文件生成

创建JSON文件并触发浏览器下载：

```typescript
const blob = new Blob([jsonString], { type: 'application/json' })
const url = URL.createObjectURL(blob)
```

### 3. 随机种子

为棋盘布局生成唯一的随机种子：

```typescript
const seed =
  Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15)
```

## 扩展性设计

### 1. 版本兼容

支持版本号管理，便于后续格式升级。

### 2. 二维码支持

预留二维码导出接口，支持配置分享。

### 3. 压缩支持

预留压缩功能接口，减少文件大小。

### 4. 导入功能

预留导入功能接口，支持配置恢复。

## 后续计划

### 短期目标

1. ✅ 基础导出功能
2. 🔄 配置导入功能
3. 🔄 二维码导出

### 中期目标

1. 配置文件压缩
2. 批量导出功能
3. 配置预览功能

### 长期目标

1. 云端配置同步
2. 配置分享社区
3. 配置模板库

## 测试

### 测试文件

- `test-export.html` - 功能测试页面

### 测试步骤

1. 启动开发服务器：`npm run dev`
2. 打开测试页面：`test-export.html`
3. 按照测试指南进行功能验证

### 验证要点

- [ ] 导出按钮正常显示
- [ ] 配置选择界面正常工作
- [ ] 文件下载功能正常
- [ ] JSON格式正确
- [ ] 数据完整性验证

## 注意事项

1. **浏览器兼容性**: 使用现代浏览器API，需要支持Blob和URL.createObjectURL
2. **文件大小**: 棋盘布局数据可能较大，注意性能影响
3. **隐私保护**: 导出的配置文件可能包含敏感信息，提醒用户注意分享安全
4. **版本管理**: 保持导出格式的向后兼容性

## 贡献指南

如需扩展导出功能，请遵循以下原则：

1. 保持类型安全
2. 添加适当的错误处理
3. 更新相关文档
4. 添加测试用例
